<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>StreamHub - פלטפורמת הסטרימינג המתקדמת</title>

    <!-- ==== Font Awesome – רק את האייקונים שבשימוש ==== -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
          rel="stylesheet" integrity="sha512-6Kc5pGqVvFhmL7O8f5rU2+e9N3X/3Uq5yUeFJq9v7aQeC/9J6+5eV5ZfBd5R9t8e7bL+v7f4N0a5cR/3K+0ZA==" 
          crossorigin="anonymous" referrerpolicy="no-referrer">

    <!-- ==== משתנים גלובליים – קובץ נפרד למען תחזוקה קלה ==== -->
    <style>
        :root{
            --primary-color:#6c5ce7;
            --secondary-color:#a29bfe;
            --accent-color:#fd79a8;
            --dark-bg:#0d1117;
            --card-bg:#161b22;
            --text-primary:#f0f6fc;
            --text-secondary:#8b949e;
            --border-color:#30363d;
            --hover-bg:#21262d;
            --success-color:#28a745;
            --warning-color:#ffc107;
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
            background:var(--dark-bg);
            color:var(--text-primary);
            line-height:1.6;
            overflow-x:hidden;
        }
        .sr-only{
            position:absolute;
            width:1px;height:1px;
            padding:0;overflow:hidden;
            clip:rect(0,0,0,0);
            white-space:nowrap;border:0;
        }
        /* ---------- Header ---------- */
        .header{
            position:fixed;top:0;left:0;right:0;
            background:linear-gradient(135deg,rgba(108,92,231,.1),rgba(13,17,23,.95));
            backdrop-filter:blur(20px);
            z-index:1000;
            padding:15px 30px;
            display:flex;justify-content:space-between;align-items:center;
            border-bottom:1px solid var(--border-color);
            transition:all .3s ease;
        }
        .logo{
            font-size:28px;font-weight:800;
            background:linear-gradient(135deg,var(--primary-color),var(--accent-color));
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            display:flex;align-items:center;gap:10px;
        }
        .nav-menu{display:flex;gap:30px;align-items:center}
        .nav-item{
            color:var(--text-secondary);
            text-decoration:none;
            font-weight:500;
            position:relative;
            transition:all .3s ease;
        }
        .nav-item:hover{color:var(--primary-color)}
        .nav-item.active::after{
            content:"";
            position:absolute;bottom:-5px;left:0;
            width:100%;height:2px;
            background:var(--primary-color);
            border-radius:2px;
        }
        /* ---------- Search Input & Dropdown (IMPROVED) ---------- */
        .search-container{
            position:relative;
            flex:1;
            max-width:500px;
            margin:0 30px;
        }
        .search-wrapper{
            position:relative;
        }
        .search-input{
            width:100%;
            padding:12px 20px 12px 50px;
            border:2px solid var(--border-color);
            border-radius:25px;
            background:var(--card-bg);
            color:var(--text-primary);
            font-size:14px;
            transition:all .3s ease;
        }
        .search-input:focus{
            outline:none;
            border-color:var(--primary-color);
            box-shadow:0 0 20px rgba(108,92,231,.3);
        }
        .search-icon{
            position:absolute;
            left:18px;top:50%;
            transform:translateY(-50%);
            color:var(--text-secondary);
            cursor:pointer;
            transition:all .3s ease;
        }
        .search-icon:hover{
            color:var(--primary-color);
            transform:translateY(-50%) scale(1.1);
        }
        .search-dropdown{
            position:absolute;
            top:calc(100% + 10px);
            left:0;right:0;
            /* FIXED: רקע שקוף יותר ומראה של מגירה קטנה */
            background:linear-gradient(135deg, rgba(22, 27, 34, 0.98), rgba(30, 35, 42, 0.98));
            backdrop-filter:blur(15px);
            border:1px solid var(--primary-color);
            border-radius:10px;
            box-shadow:0 15px 40px rgba(0,0,0,.7);
            z-index:900;
            max-height:400px;
            overflow-y:auto;
            padding:10px;
            opacity:0;
            pointer-events:none;
            transform:translateY(-10px);
            transition:all .2s ease;
        }
        .search-dropdown.active{
            opacity:1;
            pointer-events:auto;
            transform:translateY(0);
        }
        .dropdown-results{
            display:flex;
            flex-direction:column;
            gap:10px;
        }
        /* ---------- Dropdown Result Item (NEW) ---------- */
        .dropdown-item{
            display:flex;
            gap:15px;
            padding:10px;
            border-radius:8px;
            cursor:pointer;
            transition:background .2s ease;
            align-items:center;
            background:var(--card-bg);
            border:1px solid var(--border-color);
        }
        .dropdown-item:hover{
            background:var(--hover-bg);
            border-color:var(--secondary-color);
        }
        .dropdown-poster{
            width:50px;height:75px;
            flex-shrink:0;
            background-size:cover;
            background-position:center;
            border-radius:6px;
            background-color:rgba(255,255,255,.1);
            box-shadow:0 4px 10px rgba(0,0,0,.3);
        }
        .dropdown-info{
            flex:1;
        }
        .dropdown-title{
            font-size:1rem;
            font-weight:600;
            margin-bottom:5px;
            overflow:hidden;
            text-overflow:ellipsis;
            white-space:nowrap;
        }
        .dropdown-meta{
            font-size:.8rem;
            color:var(--text-secondary);
            display:flex;
            gap:10px;
            margin-bottom:8px;
        }
        .dropdown-meta i{
            color:#ffd700;
        }
        .dropdown-actions .btn{
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 15px;
            font-weight: 500;
        }
        .search-loading-dropdown{
            text-align:center;
            padding:20px;
            color:var(--text-secondary);
        }
        /* ---------- User Profile (CLEANED) ---------- */
        .user-profile{
            display:flex;align-items:center;gap:15px;
        }
        /* הסרנו: .profile-avatar ו- .addons-btn */
        /* ---------- Addons Drawer (Same) ---------- */
        .drawer-overlay{
            position:fixed;top:0;left:0;right:0;bottom:0;
            background:rgba(0,0,0,.7);
            z-index:1999;
            opacity:0;
            pointer-events:none;
            transition:opacity .3s ease;
        }
        .drawer-overlay.active{
            opacity:1;
            pointer-events:auto;
        }
        .addons-drawer{
            position:fixed;top:0;right:-400px;
            width:400px;height:100vh;
            background:var(--card-bg);
            border-left:1px solid var(--border-color);
            z-index:2000;
            transition:right .3s ease;
            overflow-y:auto;
            box-shadow:-10px 0 30px rgba(0,0,0,.5);
        }
        .addons-drawer.open{right:0}
        .drawer-header{
            padding:20px;
            border-bottom:1px solid var(--border-color);
            background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));
            display:flex;justify-content:space-between;align-items:center;
        }
        .drawer-title{
            font-size:1.5rem;font-weight:700;color:#fff;
        }
        .drawer-close{
            background:none;border:none;color:#fff;
            font-size:24px;cursor:pointer;
            padding:5px;
            border-radius:50%;
            transition:all .3s ease;
        }
        .drawer-close:hover{background:rgba(255,255,255,.2)}
        .drawer-content{padding:20px}
        .addon-item{
            background:var(--hover-bg);
            border:1px solid var(--border-color);
            border-radius:12px;
            padding:20px;
            margin-bottom:15px;
            transition:all .3s ease;
            cursor:pointer;
        }
        .addon-item:hover{
            border-color:var(--primary-color);
            transform:translateY(-2px);
            box-shadow:0 8px 20px rgba(0,0,0,.3);
        }
        .addon-header{
            display:flex;justify-content:space-between;align-items:center;
            margin-bottom:10px;
        }
        .addon-name{font-size:1.1rem;font-weight:600;color:var(--text-primary)}
        .addon-status{
            padding:4px 12px;
            border-radius:15px;
            font-size:.8rem;
            font-weight:600;
        }
        .addon-status.available{
            background:rgba(40,167,69,.2);
            color:var(--success-color);
        }
        .addon-status.premium{
            background:rgba(255,193,7,.2);
            color:var(--warning-color);
        }
        .addon-description{
            color:var(--text-secondary);
            font-size:.9rem;
            margin-bottom:15px;
            line-height:1.5;
        }
        .addon-btn{
            padding:8px 16px;
            border:none;
            border-radius:20px;
            font-size:.9rem;
            font-weight:600;
            display:inline-flex;
            align-items:center;
            gap:5px;
            transition:all .3s ease;
            text-decoration:none;
        }
        .addon-btn.install{
            background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));
            color:#fff;
        }
        .addon-btn.install:hover{
            transform:translateY(-1px);
            box-shadow:0 5px 15px rgba(108,92,231,.4);
        }
        .addon-btn.info{
            background:rgba(255,255,255,.1);
            color:var(--text-primary);
            border:1px solid var(--border-color);
        }
        .addon-btn.info:hover{
            background:rgba(255,255,255,.2);
        }
        /* ---------- Hero (Same) ---------- */
        .hero{
            height:85vh;
            background:linear-gradient(135deg,rgba(108,92,231,.3),rgba(253,121,168,.2)), 
                       linear-gradient(rgba(0,0,0,.4),rgba(0,0,0,.6));
            background-size:cover;
            background-position:center;
            display:flex;align-items:center;
            padding:0 50px;
            margin-top:80px;
            position:relative;
            overflow:hidden;
        }
        .hero::before{
            content:"";
            position:absolute;top:0;left:0;right:0;bottom:0;
            background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.05"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events:none;
        }
        .hero-content{
            max-width:600px;
            z-index:2;
            animation:fadeInUp .6s ease-out;
        }
        .hero-title{
            font-size:4rem;
            font-weight:900;
            margin-bottom:20px;
            background:linear-gradient(135deg,var(--text-primary),var(--secondary-color));
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            text-shadow:2px 2px 4px rgba(0,0,0,.5);
        }
        .hero-description{
            font-size:1.3rem;
            margin-bottom:30px;
            color:var(--text-secondary);
            line-height:1.8;
        }
        .hero-buttons{
            display:flex;gap:20px;flex-wrap:wrap;
        }
        .btn{
            padding:15px 30px;
            border:none;
            border-radius:25px;
            font-size:16px;
            font-weight:600;
            cursor:pointer;
            display:flex;align-items:center;gap:10px;
            text-decoration:none;
            transition:all .3s ease;
        }
        .btn-primary{
            background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));
            color:#fff;
        }
        .btn-primary:hover{
            transform:translateY(-2px);
            box-shadow:0 10px 25px rgba(108,92,231,.4);
        }
        .btn-secondary{
            background:rgba(255,255,255,.1);
            color:var(--text-primary);
            border:2px solid rgba(255,255,255,.2);
        }
        .btn-secondary:hover{
            background:rgba(255,255,255,.2);
            transform:translateY(-2px);
        }
        /* ---------- Content Grid (Same) ---------- */
        .content-section{
            padding:60px 30px;
        }
        .section-header{
            display:flex;justify-content:space-between;align-items:center;
            margin-bottom:30px;
        }
        .section-title{
            font-size:2rem;
            font-weight:700;
            color:var(--text-primary);
        }
        .view-all{
            color:var(--primary-color);
            font-weight:600;
            text-decoration:none;
            transition:all .3s ease;
        }
        .view-all:hover{color:var(--secondary-color)}
        .content-grid{
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
            gap:20px;
            overflow:auto;
        }
        .content-card{
            background:var(--card-bg);
            border:1px solid var(--border-color);
            border-radius:15px;
            overflow:hidden;
            cursor:pointer;
            transition:all .3s ease;
            position:relative;
        }
        .content-card:hover{
            transform:translateY(-8px) scale(1.02);
            box-shadow:0 20px 40px rgba(0,0,0,.3);
            border-color:var(--primary-color);
        }
        .card-image{
            height:70%;
            position:relative;
        }
        .card-image img{
            width:100%;height:100%;
            object-fit:cover;
            display:block;
        }
        .card-overlay{
            position:absolute;
            inset:0;
            background:linear-gradient(transparent,rgba(0,0,0,.8));
            opacity:0;
            transition:opacity .3s ease;
            display:flex;
            align-items:center;
            justify-content:center;
        }
        .content-card:hover .card-overlay{opacity:1}
        .play-button{
            width:60px;height:60px;
            border-radius:50%;
            background:rgba(255,255,255,.9);
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:24px;
            color:var(--dark-bg);
            transition:all .3s ease;
        }
        .play-button:hover{
            transform:scale(1.1);
            background:#fff;
        }
        .card-info{
            padding:20px;
            height:30%;
        }
        .card-title{
            font-size:1.1rem;
            font-weight:600;
            margin-bottom:8px;
            color:var(--text-primary);
            overflow:hidden;
            text-overflow:ellipsis;
            white-space:nowrap;
        }
        .card-meta{
            display:flex;
            justify-content:space-between;
            align-items:center;
            color:var(--text-secondary);
            font-size:.9rem;
        }
        .rating{
            display:flex;
            align-items:center;
            gap:5px;
        }
        .rating i{color:#ffd700}
        /* ---------- Modal (Same) ---------- */
        .modal{
            display:none;
            position:fixed;
            inset:0;
            background:rgba(0,0,0,.9);
            z-index:2000;
            align-items:center;
            justify-content:center;
            backdrop-filter:blur(10px);
        }
        .modal[open]{display:flex}
        .modal-content{
            max-width:900px;
            width:90%;
            background:var(--card-bg);
            border-radius:20px;
            overflow:hidden;
            position:relative;
            border:1px solid var(--border-color);
        }
        .modal-header{
            height:400px;
            background-size:cover;
            background-position:center;
            position:relative;
        }
        .modal-close{
            position:absolute;
            top:20px;right:20px;
            width:40px;height:40px;
            border-radius:50%;
            background:rgba(0,0,0,.7);
            border:none;
            color:#fff;
            font-size:20px;
            cursor:pointer;
            transition:all .3s ease;
        }
        .modal-close:hover{
            background:rgba(0,0,0,.9);
            transform:scale(1.1);
        }
        .modal-body{
            padding:30px;
        }
        .modal-title{
            font-size:2.5rem;
            font-weight:700;
            margin-bottom:15px;
            color:var(--text-primary);
        }
        .modal-meta{
            display:flex;
            gap:20px;
            margin-bottom:20px;
            color:var(--text-secondary);
        }
        .modal-description{
            font-size:1.1rem;
            line-height:1.8;
            margin-bottom:30px;
            color:var(--text-secondary);
        }
        .modal-actions{
            display:flex;
            gap:15px;
            flex-wrap:wrap;
        }
        /* ---------- FAB (CHANGED) ---------- */
        /* הסרנו את FAB החזרה לראש הדף */
        .fab-addons{
            position:fixed;
            right:30px;
            bottom:30px;
            background:linear-gradient(45deg, var(--accent-color), var(--primary-color));
            color:#fff;
            border:none;
            padding:15px 25px;
            border-radius:30px;
            font-weight:600;
            font-size:16px;
            cursor:pointer;
            box-shadow:0 10px 30px rgba(253, 121, 168, 0.4);
            transition:all .3s ease;
            z-index:999;
            display:flex;
            align-items:center;
            gap:10px;
        }
        .fab-addons:hover{
            transform:translateY(-2px);
            box-shadow:0 15px 40px rgba(253, 121, 168, 0.6);
        }
        
        /* הסרנו את סגנונות ה-addons-fab וה-fab המקוריים */
        .addons-fab, .fab { display: none !important; } 

        /* ---------- Search Drawer (Removed - Cleaned up old styles) ---------- */
        .search-overlay, .search-drawer { display: none !important; }

        /* ---------- Notification (Same) ---------- */
        .notification{
            position:fixed;
            top:100px;
            right:30px;
            background:var(--card-bg);
            border:1px solid var(--border-color);
            border-radius:12px;
            padding:15px 20px;
            z-index:3000;
            transform:translateX(400px);
            transition:all .3s ease;
            box-shadow:0 10px 30px rgba(0,0,0,.3);
        }
        .notification.show{transform:translateX(0)}
        .notification.success{
            border-color:var(--success-color);
            background:rgba(40,167,69,.1);
        }
        .notification.error{
            border-color:#dc3545;
            background:rgba(220,53,69,.1);
        }
        /* ---------- Custom Scrollbars (Same) ---------- */
        ::-webkit-scrollbar{
            width:8px;height:8px;
        }
        ::-webkit-scrollbar-track{
            background:rgba(255,255,255,.05);
            border-radius:10px;
        }
        ::-webkit-scrollbar-thumb{
            background:linear-gradient(135deg,var(--primary-color),#8b5cf6);
            border-radius:10px;
            border:1px solid rgba(255,255,255,.1);
        }
        ::-webkit-scrollbar-thumb:hover{
            background:linear-gradient(135deg,#7c3aed,var(--primary-color));
            box-shadow:0 0 10px rgba(139,92,246,.3);
        }
        /* ---------- Responsive ---------- */
        @media (max-width:768px){
            .header{padding:10px 20px;flex-wrap:wrap}
            .nav-menu{display:none}
            .search-container{order:3;margin:10px 0;flex-basis:100%; max-width:100%;}
            .hero{padding:0 20px;height:70vh}
            .hero-title{font-size:2.5rem}
            .hero-buttons{flex-direction:column}
            .addons-drawer{width:100%;right:-100%}
            .addons-drawer.open{right:0}
            /* search dropdown on mobile */
            .search-dropdown{
                position:fixed;
                top:80px;
                left:10px;right:10px;
                width:auto;
            }
            .fab-addons{right:15px; bottom:15px; font-size:14px; padding:12px 20px;}
        }
        @keyframes fadeInUp{
            from{opacity:0;transform:translateY(30px)}
            to{opacity:1;transform:translateY(0)}
        }
        /* ---------- Category Buttons (FIXED/ADDED) ---------- */
        .categories{
            display:flex;
            gap:10px;
            padding:10px 0;
            overflow-x:auto; /* מאפשר גלילה רוחבית */
            white-space:nowrap;
            margin-bottom:20px;
            border-bottom:1px solid var(--border-color);
        }
        .category-btn{
            background:var(--card-bg);
            color:var(--text-secondary);
            border:1px solid var(--border-color);
            padding:8px 15px;
            border-radius:20px;
            font-size:14px;
            font-weight:500;
            cursor:pointer;
            transition:all .3s ease;
            flex-shrink:0; /* מונע התכווצות כפתורים */
        }
        .category-btn:hover{
            color:var(--text-primary);
            border-color:var(--secondary-color);
        }
        .category-btn.active{
            background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));
            border-color:var(--primary-color);
            color:#fff;
            box-shadow:0 4px 15px rgba(108,92,231,.4);
        }
        /* ---------- Spinner/Loading (FIXED) ---------- */
        .spinner{
            border:4px solid rgba(255,255,255,.1);
            border-top:4px solid var(--primary-color);
            border-radius:50%;
            width:40px;
            height:40px;
            animation:spin 1s linear infinite;
            margin:0 auto 15px;
        }
        @keyframes spin{
            0%{transform:rotate(0deg)}
            100%{transform:rotate(360deg)}
        }
        /* ---------- Skeleton Loading (ADDED) ---------- */
        .content-card.skeleton{
            min-width:220px;
            height:400px;
            background:var(--card-bg);
            cursor:default;
            border-color:var(--border-color) !important;
            transform:none !important;
            box-shadow:none !important;
            animation:pulse 1.5s infinite ease-in-out;
        }
        .content-card.skeleton .card-image{
            background:var(--hover-bg) !important;
        }
        .content-card.skeleton .card-info div{
            height:16px;
            background:var(--hover-bg);
            border-radius:4px;
            margin-bottom:8px;
        }
        .content-card.skeleton .card-info .card-title{
            width:80%;
        }
        .content-card.skeleton .card-info .card-meta{
            width:50%;
        }
        @keyframes pulse{
            0%{opacity:.6}
            50%{opacity:.3}
            100%{opacity:.6}
        }
        /* Fallback for missing images */
        .card-image img[src$="null"], 
        .card-image img:not([src]):before {
            content: "אין פוסטר";
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--text-secondary);
            background: var(--hover-bg);
            width: 100%; height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body>

<!------------------- Header ------------------->
<header class="header">
    <div class="logo">
        <i class="fas fa-play-circle" aria-hidden="true"></i>
        StreamHub
    </div>

    <nav class="nav-menu" aria-label="תפריט ראשי">
        <a href="#" class="nav-item active" aria-current="page">בית</a>
        <a href="#" class="nav-item">סרטים</a>
        <a href="#" class="nav-item">סדרות</a>
        <a href="#" class="nav-item">האהובים שלי</a>
    </nav>

    <!-- NEW: Dropdown Search -->
    <div class="search-container" id="searchContainer">
        <div class="search-wrapper">
            <i class="fas fa-search search-icon" id="searchIcon" aria-hidden="true"
               title="חיפוש"></i>
            <input type="search" id="searchInput" class="search-input"
                   placeholder="הקלד לחיפוש סרטים וסדרות..."
                   aria-label="חיפוש סרטים וסדרות">
        </div>
        <!-- Search Dropdown - Mini-Drawer Style -->
        <div class="search-dropdown" id="searchDropdown">
            <div class="dropdown-results" id="dropdownResults">
                <p class="search-loading-dropdown" id="dropdownSuggestions">
                    התחל להקליד כדי לראות תוצאות...
                </p>
            </div>
        </div>
    </div>
    <!-- /NEW: Dropdown Search -->

    <!-- CLEANED: Removed user-profile buttons -->
    <div class="user-profile">
        <!-- Removed: addons-btn and profile-avatar -->
    </div>
</header>

<!------------------- Addons Drawer ------------------->
<div class="drawer-overlay" id="drawerOverlay"></div>

<aside class="addons-drawer" id="addonsDrawer" role="dialog" aria-modal="true" aria-labelledby="addonsDrawerTitle">
    <div class="drawer-header">
        <h2 class="drawer-title" id="addonsDrawerTitle">תוספי Stremio</h2>
        <button class="drawer-close" id="drawerClose" aria-label="סגור תוספים">
            <i class="fas fa-times" aria-hidden="true"></i>
        </button>
    </div>
    <div class="drawer-content">
        <!-- ==== Addon 1 ==== -->
        <div class="addon-item">
            <div class="addon-header">
                <h3 class="addon-name">Torrentio + EasyDebrid</h3>
                <span class="addon-status premium">פרימיום</span>
            </div>
            <p class="addon-description">
                תוסף מתקדם לסטרימינג טורנטים עם תמיכה ב‑EasyDebrid לאיכות גבוהה וללא המתנה.
            </p>
            <div class="addon-actions">
                <a href="stremio://torrentio.strem.fun/easydebrid=n3cgfuzhg9ptzbss/manifest.json"
                   class="addon-btn install" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    התקן
                </a>
            </div>
        </div>
        <!-- ==== Addon 2 ==== -->
        <div class="addon-item">
            <div class="addon-header">
                <h3 class="addon-name">כתוביות Wizdom</h3>
                <span class="addon-status available">זמין</span>
            </div>
            <p class="addon-description">
                תוסף כתוביות עברית מ‑Wizdom. מספק כתוביות איכותיות לסרטים וסדרות בעברית עם סנכרון מושלם.
            </p>
            <div class="addon-actions">
                <a href="stremio://4b139a4b7f94-wizdom-stremio-v2.baby-beamup.club/manifest.json"
                   class="addon-btn install" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    התקן
                </a>
            </div>
        </div>
        <!-- ==== Addon 3 ==== -->
        <div class="addon-item">
            <div class="addon-header">
                <h3 class="addon-name">כתוביות Ktuvit</h3>
                <span class="addon-status available">זמין</span>
            </div>
            <p class="addon-description">
                תוסף כתוביות עברית מ‑Ktuvit. מאגר עצום של כתוביות עבריות לתוכן חדש וישן עם עדכונים שוטפים.
            </p>
            <div class="addon-actions">
                <a href="stremio://4b139a4b7f94-ktuvit-stremio.baby-beamup.club/manifest.json"
                   class="addon-btn install" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    התקן
                </a>
            </div>
        </div>
        <!-- ==== Addon 4 ==== -->
        <div class="addon-item">
            <div class="addon-header">
                <h3 class="addon-name">תאריכי יציאה לרשת</h3>
                <span class="addon-status available">זמין</span>
            </div>
            <p class="addon-description">
                תוסף שמעדכן מתי יוצאים סרטים חדשים לרשת באיכות טובה. עוזר לדעת מתי כדאי לחפש תוכן חדש.
            </p>
            <div class="addon-actions">
                <a href="stremio://stremio7rd-movies-online-dates.vercel.app/manifest.json"
                   class="addon-btn install" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    התקן
                </a>
            </div>
        </div>
        <!-- ==== Addon 5 ==== -->
        <div class="addon-item">
            <div class="addon-header">
                <h3 class="addon-name">TMDB עברית</h3>
                <span class="addon-status available">זמין</span>
            </div>
            <p class="addon-description">
                תוסף לפוסטרים ואפשרות חיפוש תכנים בעברית. משפר את חוויית הגלישה עם תמיכה מלאה בעברית ופוסטרים איכותיים.
            </p>
            <div class="addon-actions">
                <a href="stremio://94c8cb9f702d-tmdb-addon.baby-beamup.club/N4IgNghgdg5grhGBTEAuEALJBaAkgGRABoQBnAFwCckIBbAS1jQG0BdEgYwnIjAHsYpFqHoATNCHK1RAIwB05PgAdikgJ5KU6WnwBu9FCSh0tIAArK4kSqtIY+Ad1xQAEn1paqcJAF8iI8XQpWQVlVXINU1IkSgMhIxMJCyUrCBsSO0dnNw80L19-EDEJYPk1GnT1TQkdfUMQY1z0AE0K23snV3dPSm8-AJLpMraSCOr0aNikeIbElpGyDuzuvN6CgaChuUhYBGRwyJq9A1VG03xoeER6zM6cnr7C4s2Qnav90cOJmLjTuZALrtru0sl0mvl+kVApItlQkFBRIwYAdxiBaicEk0QAAVagIpEgu4rVAQp7Q0oKPGIpifVGTX6Y0y4+HU5EZJZgh6+dggLgUADCfDgUHIaAArD4gA/manifest.json"
                   class="addon-btn install" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    התקן
                </a>
            </div>
        </div>
    </div>
</aside>

<!------------------- Hero ------------------->
<section class="hero" id="hero" role="region" aria-label="חלק ראשי">
    <div class="hero-content">
        <h1 class="hero-title" id="heroTitle">ברוכים הבאים ל‑StreamHub</h1>
        <p class="hero-description" id="heroDescription">
            גלה אלפי סרטים וסדרות באיכות גבוהה. צפה בתוכן הכי חדש והכי פופולרי מכל הזמנים.
        </p>
        <div class="hero-buttons">
            <a href="#"
               class="btn btn-primary"
               onclick="playFeatured();return false;">
                <i class="fas fa-play" aria-hidden="true"></i>
                צפה עכשיו
            </a>
            <a href="#"
               class="btn btn-secondary"
               onclick="addToWatchlist();return false;">
                <i class="fas fa-plus" aria-hidden="true"></i>
                הוסף לרשימה
            </a>
        </div>
    </div>
</section>

<!------------------- Categories ------------------->
<section class="content-section" aria-label="קטגוריות חיפוש">
    <div class="categories" role="tablist">
        <button class="category-btn active" data-category="all" role="tab" aria-selected="true">הכל</button>
        <button class="category-btn" data-category="movie" role="tab" aria-selected="false">סרטים</button>
        <button class="category-btn" data-category="tv" role="tab" aria-selected="false">סדרות</button>
        <button class="category-btn" data-category="trending" role="tab" aria-selected="false">פופולרי</button>
        <button class="category-btn" data-category="top_rated" role="tab" aria-selected="false">מדורג גבוה</button>
    </div>
</section>

<!------------------- Trending Movies ------------------->
<section class="content-section" aria-labelledby="trendingTitle">
    <div class="section-header">
        <h2 class="section-title" id="trendingTitle">סרטים פופולריים</h2>
        <a href="#" class="view-all">צפה בהכל</a>
    </div>
    <div class="content-grid" id="trendingMovies"></div>
</section>

<!------------------- Top Rated Series ------------------->
<section class="content-section" aria-labelledby="topSeriesTitle">
    <div class="section-header">
        <h2 class="section-title" id="topSeriesTitle">סדרות מדורגות</h2>
        <a href="#" class="view-all">צפה בהכל</a>
    </div>
    <div class="content-grid" id="topSeries"></div>
</section>

<!------------------- Popular Movies ------------------->
<section class="content-section" aria-labelledby="popularTitle">
    <div class="section-header">
        <h2 class="section-title" id="popularTitle">סרטים מומלצים</h2>
        <a href="#" class="view-all">צפה בהכל</a>
    </div>
    <div class="content-grid" id="popularMovies"></div>
</section>

<!------------------- Modal ------------------->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
        <div class="modal-header" id="modalHeader">
            <button class="modal-close" onclick="closeModal()" aria-label="סגור חלון">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
        <div class="modal-body">
            <h2 class="modal-title" id="modalTitle"></h2>
            <div class="modal-meta">
                <span id="modalYear"></span>
                <span id="modalRating"></span>
                <span id="modalGenres"></span>
            </div>
            <p class="modal-description" id="modalDescription"></p>
            <div class="modal-actions">
                <button class="btn btn-primary" id="modalPlay">
                    <i class="fas fa-play" aria-hidden="true"></i>
                    צפה עכשיו
                </button>
                <button class="btn btn-secondary" id="modalWatchlist">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                    הוסף לרשימה
                </button>
                <button class="btn btn-secondary" id="modalTrailer">
                    <i class="fas fa-video" aria-hidden="true"></i>
                    טריילר
                </button>
            </div>
        </div>
    </div>
</div>

<!------------------- FABs (CHANGED) ------------------->
<!-- CHANGED: FAB for Addons is now a distinct button (הוסר העיגול הראשי והכפתור השני) -->
<button class="fab-addons" id="addonsFab" aria-label="התקנת הרחבות">
    <i class="fas fa-puzzle-piece" aria-hidden="true"></i>
    להתקנת הרחבות לחצו כאן
</button>

<!------------------- Notification ------------------->
<div class="notification" id="notification" role="alert"></div>

<!------------------- Scripts ------------------->
<script type="module">
/* ====================== CONFIG (FIXED) ====================== */
const API_KEY        = '93f0d2ee2e3e60d061d14d91cbb47b46'; // נשאר כמידע
const API_URL        = 'https://api.themoviedb.org/3';
const IMG_URL        = 'https://image.tmdb.org/t/p/w500';
const BACKDROP_URL   = 'https://image.tmdb.org/t/p/original';
// FIXED: השימוש ב-Bearer Token ששלחת לטובת אימות תקין
const BEARER_TOKEN   = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI5M2YwZDJlZTJlM2U2MGQwNjFkMTRkOTFjYmI0N2I0NiIsIm5iZiI6MTc1OTEzMzQ5Mi42Miwic3ViIjoiNjhkYTNmMzQwM2M5MjhhMzYyYzc2NWU1Iiwic2NvcGVzIjpbImFwaV9yZWFkIl0sInZlcnNpb24iOjF9.VG21edI_Bp_Vz3Ik8MHtCWCa2WiJtbTRIsuvOo91CCM'; 

/* ====================== CACHING ====================== */
const CACHE_TTL = 12 * 60 * 60 * 1000; // 12 שעות
function setCache(key, data){
    localStorage.setItem(key, JSON.stringify({ts:Date.now(),data}));
}
function getCache(key){
    const raw = localStorage.getItem(key);
    if(!raw) return null;
    const {ts,data} = JSON.parse(raw);
    return (Date.now() - ts) < CACHE_TTL ? data : null;
}

/* ====================== API (FIXED) ====================== */
async function fetchData(endpoint){
    const cached = getCache(endpoint);
    if(cached) return cached;

    // FIXED: שימוש ב-Bearer Token ב-Header במקום ב-API Key ב-URL, הוספת טיפול בשגיאות
    const url = `${API_URL}${endpoint.includes('?') ? endpoint : endpoint + '?'}&language=he-IL&page=1`;

    try {
        const resp = await fetch(url, {
            headers:{
                'Authorization': `Bearer ${BEARER_TOKEN}`,
                'Content-Type': 'application/json'
            }
        });
        
        if(!resp.ok) {
            const errorBody = await resp.json().catch(() => ({}));
            const errorMessage = errorBody.status_message || resp.statusText || `Unknown Error ${resp.status}`;
            throw new Error(`TMDB error ${resp.status}: ${errorMessage}`);
        }
        
        const data = await resp.json();
        setCache(endpoint, data);
        return data;
    } catch (e) {
        console.error(`Fetch failed for ${endpoint}:`, e.message);
        showToast(`שגיאה בטעינת נתונים: ${e.message.substring(0, 50)}...`, 'error');
        throw e;
    }
}

/* ====================== RENDER SKELETON (NEW) ====================== */
function renderSkeleton(containerId, count=6){
    const container = document.getElementById(containerId);
    if(!container) return;
    const skeletonCard = `
        <div class="content-card skeleton">
            <div class="card-image"></div>
            <div class="card-info">
                <h3 class="card-title"></h3>
                <div class="card-meta">
                    <span></span>
                    <div class="rating"></div>
                </div>
            </div>
        </div>
    `;
    container.innerHTML = Array(count).fill(skeletonCard).join('');
}


/* ====================== RENDER GRID (IMPROVED) ====================== */
function renderGrid(containerId, data, type='movie'){
    const container = document.getElementById(containerId);
    if(!data?.results?.length){
        container.innerHTML = '<p class="text-center" style="color:var(--text-secondary);">לא נמצא תוכן</p>';
        return;
    }
    container.innerHTML = data.results.map(item=>{
        const posterSrc = item.poster_path ? IMG_URL + item.poster_path : ''; // אם אין, מחזיר ריק, וה-CSS יטפל בטקסט חלופי
        return `
            <div class="content-card" 
                 tabindex="0"
                 role="button"
                 onclick="openModal(${JSON.stringify(item).replace(/"/g,'&quot;')}, '${item.media_type||type}')">
                <div class="card-image">
                    <img src="${posterSrc}" loading="lazy" 
                         alt="${item.title||item.name} – פוסטר">
                    <div class="card-overlay">
                        <div class="play-button"><i class="fas fa-play"></i></div>
                    </div>
                </div>
                <div class="card-info">
                    <h3 class="card-title">${item.title||item.name}</h3>
                    <div class="card-meta">
                        <span>${(item.release_date||item.first_air_date||'').slice(0,4) || '–'}</span>
                        <div class="rating"><i class="fas fa-star"></i> ${item.vote_average?.toFixed(1) || '0'}</div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

/* ====================== MODAL (IMPROVED) ====================== */
async function openModal(item, type){
    const modal       = document.getElementById('modal');
    const header      = document.getElementById('modalHeader');
    const titleEl     = document.getElementById('modalTitle');
    const yearEl      = document.getElementById('modalYear');
    const ratingEl    = document.getElementById('modalRating');
    const genreEl     = document.getElementById('modalGenres');
    const descEl      = document.getElementById('modalDescription');
    const playBtn     = document.getElementById('modalPlay');
    const watchBtn    = document.getElementById('modalWatchlist');
    const trailerBtn  = document.getElementById('modalTrailer');

    // רקע
    if(item.backdrop_path){
        header.style.backgroundImage = `linear-gradient(rgba(0,0,0,.4),rgba(0,0,0,.7)), url('${BACKDROP_URL+item.backdrop_path}')`;
    }else{
        header.style.backgroundImage = 'none';
    }
    // פרטים בסיסיים
    titleEl.textContent   = item.title || item.name;
    // FIXED: קיצור לשנה בלבד
    yearEl.textContent    = (item.release_date || item.first_air_date || 'לא ידוע').slice(0,4); 
    ratingEl.innerHTML    = `<i class="fas fa-star"></i> ${item.vote_average?.toFixed(1) || '0'}/10`;
    descEl.textContent    = item.overview || 'אין תיאור';

    // ז'אנרים – קריאת פרטים נפרדת
    try{
        const details = await fetchData(`${type === 'tv' ? '/tv' : '/movie'}/${item.id}`);
        genreEl.textContent = (details.genres||[]).map(g=>g.name).join(', ');
    }catch(e){
        genreEl.textContent = 'לא ידוע';
    }

    // פעולות
    playBtn.onclick   = ()=>playContent(item, type);
    watchBtn.onclick  = ()=>addToWatchlist(item);
    trailerBtn.onclick= ()=>playTrailer(item, type);

    modal.showModal?.() ?? (modal.style.display='flex');
    document.body.style.overflow = 'hidden'; // מונע גלילת רקע
}
function closeModal(){
    const modal = document.getElementById('modal');
    modal.close?.() ?? (modal.style.display='none');
    document.body.style.overflow = ''; // החזרת גלילה
}

/* ====================== PLAY / TRAILER (FIXED) ====================== */
async function playContent(item, type){
    try {
        const d = await fetchData(`/${type}/${item.id}/external_ids`);
        const imdb = d.imdb_id;
        
        if (imdb) {
            // FIXED: שימוש בפורמט ה-Stremio המדויק עם ה-imdb_id
            const url = `https://web.stremio.com/#/detail/${type}/${imdb}/undefined`;
            window.open(url, '_blank');
        } else {
            const url = `https://web.stremio.com/#/search?search=${encodeURIComponent(item.title||item.name)}`;
            window.open(url, '_blank');
        }
    } catch (e) {
        // Fallback למקרה של כשל API
        const url = `https://web.stremio.com/#/search?search=${encodeURIComponent(item.title||item.name)}`;
        window.open(url, '_blank');
    }
}
function playTrailer(item,type){
    fetchData(`/${type}/${item.id}/videos`)
        .then(v=>v.results.find(v=>v.type==='Trailer' && v.site==='YouTube'))
        .then(tr=>tr
            ? `https://www.youtube.com/watch?v=${tr.key}`
            : `https://www.youtube.com/results?search_query=${encodeURIComponent(item.title||item.name+' trailer')}`)
        .then(url=>window.open(url,'_blank'))
        .catch(()=>{ /* אם קיים קושי – עושים חיפוש חופשי */ });
}

/* ====================== WATCHLIST ====================== */
function addToWatchlist(item){
    const list = JSON.parse(localStorage.getItem('watchlist')||'[]');
    if(!list.find(i=>i.id===item.id)){
        list.push(item);
        localStorage.setItem('watchlist',JSON.stringify(list));
        showToast('הוסף לרשימת הצפייה!', 'success');
    }else{
        showToast('כבר ברשימת הצפייה', 'error');
    }
}

/* ====================== NOTIFICATIONS ====================== */
function showToast(text, type='success'){
    const notif = document.getElementById('notification');
    notif.textContent = text;
    notif.className = `notification ${type} show`;
    setTimeout(()=>notif.classList.remove('show'),3000);
}

/* ====================== HERO ====================== */
async function initHero(){
    try{
        const popular = await fetchData('/movie/popular');
        const hero = popular.results?.[0];
        if(hero){
            document.getElementById('heroTitle').textContent        = hero.title;
            document.getElementById('heroDescription').textContent  = hero.overview?.substring(0,200)+'…';
            if(hero.backdrop_path){
                document.getElementById('hero').style.backgroundImage =
                    `linear-gradient(135deg,rgba(108,92,231,.3),rgba(253,121,168,.2)),
                     linear-gradient(rgba(0,0,0,.4),rgba(0,0,0,.6)),
                     url('${BACKDROP_URL+hero.backdrop_path}')`;
            }
        }
    }catch(e){ console.error('Hero error',e); }
}

/* ====================== DEFAULT SECTIONS (IMPROVED) ====================== */
async function loadDefaultSections(){
    // ADDED: טען שלד לפני קריאת API
    renderSkeleton('trendingMovies');
    renderSkeleton('topSeries');
    renderSkeleton('popularMovies');
    
    try {
        const [trending, topTv, popular] = await Promise.all([
            fetchData('/trending/movie/week'),
            fetchData('/tv/top_rated'),
            fetchData('/movie/popular')
        ]);
        
        renderGrid('trendingMovies', trending, 'movie');
        renderGrid('topSeries', topTv, 'tv');
        renderGrid('popularMovies', popular, 'movie');
    } catch (e) {
        console.error("Failed to load default sections:", e);
        // ודא שהרשת נשארת ריקה או מציגה הודעה ברורה
        renderGrid('trendingMovies', null);
        renderGrid('topSeries', null);
        renderGrid('popularMovies', null);
    }
}

/* ====================== CATEGORY FILTER (IMPROVED) ====================== */
function setupCategoryButtons(){
    const btns = document.querySelectorAll('.category-btn');
    btns.forEach(btn=>{
        btn.addEventListener('click', async ()=>{
            btns.forEach(b=>b.classList.remove('active'), b.setAttribute('aria-selected','false'));
            btn.classList.add('active');
            btn.setAttribute('aria-selected','true');

            const cat = btn.dataset.category;
            
            // ADDED: הצג שלד בזמן הטעינה
            renderSkeleton('trendingMovies');
            renderSkeleton('topSeries');
            renderSkeleton('popularMovies');
            
            try {
                if(cat==='all'){
                    await loadDefaultSections();
                }else if(cat==='movie'){
                    renderGrid('trendingMovies', await fetchData('/movie/popular'), 'movie');
                    renderGrid('topSeries',      await fetchData('/movie/top_rated'), 'movie');
                    renderGrid('popularMovies', await fetchData('/movie/upcoming'), 'movie');
                }else if(cat==='tv'){
                    renderGrid('trendingMovies', await fetchData('/tv/popular'), 'tv');
                    renderGrid('topSeries',      await fetchData('/tv/top_rated'), 'tv');
                    renderGrid('popularMovies', await fetchData('/tv/on_the_air'), 'tv');
                }else if(cat==='trending'){
                    const all = await fetchData('/trending/all/week');
                    const mov = await fetchData('/trending/movie/week');
                    const tv  = await fetchData('/trending/tv/week');
                    renderGrid('trendingMovies', all, 'multi');
                    renderGrid('topSeries', mov, 'movie');
                    renderGrid('popularMovies', tv, 'tv');
                }else if(cat==='top_rated'){
                    const movies = await fetchData('/movie/top_rated');
                    const tvs    = await fetchData('/tv/top_rated');
                    const disc   = await fetchData('/discover/movie?sort_by=vote_average.desc&vote_count.gte=1000');
                    renderGrid('trendingMovies', movies, 'movie');
                    renderGrid('topSeries', tvs, 'tv');
                    renderGrid('popularMovies', disc, 'movie');
                }
            } catch (e) {
                 console.error("Failed to load category:", e);
                 // ודא שהרשת נשארת ריקה או מציגה הודעה ברורה
                 renderGrid('trendingMovies', null);
                 renderGrid('topSeries', null);
                 renderGrid('popularMovies', null);
            }
        });
    });
}

/* ====================== SEARCH DROPDOWN (NEW) ====================== */

function showSearchDropdown(){
    document.getElementById('searchDropdown').classList.add('active');
}
function hideSearchDropdown(){
    document.getElementById('searchDropdown').classList.remove('active');
}

/* חיפוש במקביל באנגלית ובעברית (DROPDOWN VERSION) */
async function performSearch(query){
    const resultsContainer = document.getElementById('dropdownResults');
    
    resultsContainer.innerHTML = `
        <p class="search-loading-dropdown">
            <i class="fas fa-spinner fa-spin"></i>
            מחפש תוכן עבור "${query}"...
        </p>
    `;
    
    try {
        const [en, he] = await Promise.all([
            fetchData(`/search/multi?language=en-US&query=${encodeURIComponent(query)}`), 
            fetchData(`/search/multi?language=he-IL&query=${encodeURIComponent(query)}`)
        ]);

        // מיזוג ללא כפילויות, הסרת אנשים
        const map = new Map();
        (en.results||[]).forEach(i=>map.set(i.id,i));
        (he.results||[]).forEach(i=>{if(!map.has(i.id)) map.set(i.id,i);});

        const merged = [...map.values()].filter(i=>i.media_type!=='person'); 

        if(merged.length){
            renderDropdownResults(merged);
        }else{
            resultsContainer.innerHTML = `
                <p class="search-loading-dropdown">
                    <i class="fas fa-search"></i>
                    לא נמצא תוכן עבור "${query}".
                </p>`;
        }
    } catch (e) {
        resultsContainer.innerHTML = `
            <p class="search-loading-dropdown" style="color:#dc3545;">
                <i class="fas fa-exclamation-triangle"></i>
                שגיאה בחיפוש. נסה שוב מאוחר יותר.
            </p>`;
    }
}

/* הצגת תוצאות חיפוש (DROPDOWN VERSION - MINI-DRAWER STYLE) */
function renderDropdownResults(list){
    const container = document.getElementById('dropdownResults');
    
    // הצגת 5 תוצאות ראשונות בלבד
    container.innerHTML = list.slice(0, 5).map(item=>{ 
        const year   = (item.release_date||item.first_air_date||'').slice(0,4);
        const rating = item.vote_average?.toFixed(1) ?? 'N/A';
        const type   = item.media_type==='tv' ? 'סדרה' : 'סרט';
        const poster = item.poster_path ? `${IMG_URL+item.poster_path}` : '';
        
        // יצירת קישור צפייה (Play Content)
        const playAction = `playContent(${JSON.stringify(item).replace(/"/g,'&quot;')}, '${item.media_type||'movie'}'); event.stopPropagation();`;
        
        return `
            <div class="dropdown-item" 
                 role="button"
                 tabindex="0"
                 onclick="openModal(${JSON.stringify(item).replace(/"/g,'&quot;')}, '${item.media_type||'movie'}'); hideSearchDropdown();">
                <div class="dropdown-poster" style="background-image:url('${poster}')"></div>
                <div class="dropdown-info">
                    <div class="dropdown-title">${item.title||item.name}</div>
                    <div class="dropdown-meta">
                        <span>${year}</span>
                        <span><i class="fas fa-star"></i> ${rating}</span>
                        <span>${type}</span>
                    </div>
                    <div class="dropdown-actions">
                        <button class="btn btn-primary" onclick="${playAction}">
                            <i class="fas fa-play"></i>
                            צפייה
                        </button>
                        <button class="btn btn-secondary" onclick="addToWatchlist(${JSON.stringify(item).replace(/"/g,'&quot')}); event.stopPropagation();">
                            <i class="fas fa-plus"></i>
                            רשימה
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}


/* הפעלה של חיפוש בזמן שהמשתמש מקליד (DROPDOWN VERSION) */
function initSearch(){
    const input = document.getElementById('searchInput');
    
    let timeout;
    
    input.addEventListener('focus', showSearchDropdown);
    
    // הסתרת ה-Dropdown בלחיצה מחוץ לחיפוש
    document.addEventListener('click', (e) => {
        const searchContainer = document.getElementById('searchContainer');
        if (!searchContainer.contains(e.target)) {
            hideSearchDropdown();
        }
    });
    
    // מניעת הסתרה בלחיצה בתוך ה-Dropdown
    document.getElementById('searchDropdown').addEventListener('click', (e) => {
        e.stopPropagation();
    });

    input.addEventListener('input', e=>{
        const q = e.target.value.trim();
        clearTimeout(timeout);
        
        if(q.length>2){
            showSearchDropdown(); // ודא שהוא פתוח עם תוצאות
            timeout = setTimeout(()=>performSearch(q),300);
        } else if (q.length === 0) {
            document.getElementById('dropdownResults').innerHTML = '<p class="search-loading-dropdown" id="dropdownSuggestions">התחל להקליד כדי לראות תוצאות...</p>';
        } else {
            // הותיר את ה-Dropdown פתוח גם אם יש תו אחד או שניים, אבל ללא תוצאות API
            document.getElementById('dropdownResults').innerHTML = '<p class="search-loading-dropdown">המשך להקליד...</p>';
        }
    });
}

/* ====================== FAB ACTIONS (REMOVED) ====================== */
// פונקציית scrollToTop הוסרה כיוון שהכפתור הוסר.

/* ====================== ADDONS DRAWER (IMPROVED) ====================== */
function toggleAddonsDrawer(open){
    const drawer = document.getElementById('addonsDrawer');
    const overlay = document.getElementById('drawerOverlay');
    if(open){
        drawer.classList.add('open');
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // מונע גלילה ברקע
    }else{
        drawer.classList.remove('open');
        overlay.classList.remove('active');
        document.body.style.overflow = ''; // החזרת גלילה
    }
}
// הוסר ה-click listener של addonsBtn
document.getElementById('addonsFab').addEventListener('click',()=>toggleAddonsDrawer(true));
document.getElementById('drawerClose').addEventListener('click',()=>toggleAddonsDrawer(false));
document.getElementById('drawerOverlay').addEventListener('click',()=>toggleAddonsDrawer(false));

/* ====================== HEADER SCROLL EFFECT ====================== */
function initHeaderScroll(){
    const header = document.querySelector('.header');
    let lastY = window.scrollY;
    window.addEventListener('scroll',()=>{
        const curY = window.scrollY;
        if(curY>100){
            header.style.background = 'rgba(13,17,23,.95)';
        }else{
            header.style.background = 'linear-gradient(135deg,rgba(108,92,231,.1),rgba(13,17,23,.95)';
        }
        header.style.transform = curY>lastY && curY>100 ? 'translateY(-100%)' : 'translateY(0)';
        lastY = curY;
    });
}

/* ====================== Service Worker ====================== */
if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js')
        .then(()=>console.log('SW registered'))
        .catch(err=>console.error('SW registration failed',err));
}

/* ====================== INIT (IMPROVED ACCESSIBILITY) ====================== */
document.addEventListener('DOMContentLoaded', async ()=>{
    await initHero();
    await loadDefaultSections();
    setupCategoryButtons();
    // CHANGED: שימוש ב-initSearch החדש
    initSearch(); 
    initHeaderScroll();

    // ADDED: סגירת מודל בלחיצת 'Esc' ובלחיצה מחוץ לתוכן
    document.getElementById('modal').addEventListener('click', e=>{
        if(e.target.id === 'modal') closeModal();
    });
    
    // ADDED: סגירת חלונות באמצעות Esc
    document.addEventListener('keydown', e=>{
        if(e.key === 'Escape'){
            if(document.getElementById('modal').style.display === 'flex') closeModal();
            if(document.getElementById('addonsDrawer').classList.contains('open')) toggleAddonsDrawer(false);
            if(document.getElementById('searchDropdown').classList.contains('active')) hideSearchDropdown(); // CHANGED
        }
    });
});
</script>

<!------------------- Service Worker (inline for demo) ------------------->
<script>
    // sw.js – נשמר במקור根 של האתר
    const CACHE_NAME = 'streamhub-v1';
    const ASSETS = [
        '/', // index.html
        // אפשר להוסיף כאן קבצים סטטיים (css/js/תמונות)
    ];
    self.addEventListener('install', e=>{
        e.waitUntil(
            caches.open(CACHE_NAME).then(cache=>cache.addAll(ASSETS))
        );
    });
    self.addEventListener('fetch', e=>{
        e.respondWith(
            caches.match(e.request).then(resp=>resp || fetch(e.request))
        );
    });
</script>
</body>
</html>
