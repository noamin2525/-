


<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>×”××œ×¦×•×ª ×œ×¡×¨×˜×™× ×•×¡×“×¨×•×ª</title>
<meta content="light dark" name="color-scheme"/>
<style>
    :root { 
      --bg: #f8f9fa; /* Light background for inviting feel */
      --text: #1a1a1a; 
      --muted: #6c757d; 
      --card: #ffffff; 
      --border: #dee2e6; 
      --brand-600: #6f42c1; /* Vibrant purple for Stremio theme */
      --brand-700: #563d7c; 
      --chip-bg: #e9ecef; 
      --chip-border: #ced4da; 
      --chip-active: #d1e7dd; /* Soft green for active */
      --btn-ghost: #212529; 
      --shadow: rgba(0, 0, 0, 0.1); 
      --topbar-h: 64px; /* Slightly taller for modern look */
      --accent-color: #ff6b6b; /* Colorful red accent */
      --secondary-accent: #4ecdc4; /* Teal for variety */
    }
    .dark { 
      --bg: #121212; 
      --text: #e9ecef; 
      --muted: #adb5bd; 
      --card: #1e1e1e; 
      --border: #343a40; 
      --chip-bg: #2c2c2c; 
      --chip-border: #495057; 
      --chip-active: #2a9d8f; /* Dark mode active color */
      --btn-ghost: #e9ecef; 
      --shadow: rgba(0, 0, 0, 0.5); 
    }
    html{scroll-behavior:smooth; scroll-padding-top: var(--topbar-h)} 
    body{margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:var(--bg); color:var(--text); line-height:1.5;}
    .container{max-width:1200px; margin-inline:auto; padding-inline:16px;}
    .topbar{background: linear-gradient(135deg, var(--brand-600), var(--brand-700)); /* Colorful gradient */ color: #fff; border-bottom:none; box-shadow: 0 2px 10px var(--shadow);} 
    .topbar .row{display:flex; gap:16px; align-items:center; height:var(--topbar-h); justify-content:space-between;} 
    .topbar h1{font-size:clamp(20px, 2.5vw, 28px); font-weight:700; margin:0; text-shadow: 0 1px 2px rgba(0,0,0,0.2);}
    @media(min-width:900px){ .topbar{position:sticky; top:0; z-index:20; backdrop-filter:blur(12px);} }
    .btn{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--border); background:var(--chip-bg); color:var(--text); padding:10px 16px; border-radius:12px; font-size:15px; cursor:pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px var(--shadow);}
    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px var(--shadow); }
    .btn.primary{background: linear-gradient(135deg, var(--brand-600), var(--accent-color)); color:#fff; border-color:transparent;}
    .btn.ghost{background:transparent; color:#fff; border:none;} /* Updated for topbar */
    .filters{background: linear-gradient(180deg, rgba(111,66,193,0.1), transparent 70%); padding:16px 0; border-bottom:1px solid var(--border);}
    .filters .wrap{display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));}
    .input,select{width:100%; background:var(--chip-bg); color:var(--text); border:1px solid var(--border); padding:12px 16px; border-radius:12px; outline:none; transition: border-color 0.3s;}
    .input:focus, select:focus { border-color: var(--brand-600); }
    .chips{display:flex; flex-wrap:wrap; gap:10px; justify-content:center;}
    .chip{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--chip-border); background:var(--chip-bg); padding:8px 14px; border-radius:999px; font-size:14px; cursor:pointer; color:var(--text); transition: all 0.3s ease; box-shadow: 0 1px 3px var(--shadow);}
    .chip:hover { background: var(--chip-active); transform: scale(1.05); }
    .chip.active{outline:2px solid var(--brand-600); background:var(--chip-active); font-weight:bold;}
    .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(180px, 1fr)); gap:16px; padding:20px 0;}
    .card{border:1px solid var(--border); background:var(--card); border-radius:16px; overflow:hidden; box-shadow:0 4px 15px var(--shadow); transition: transform 0.3s ease, box-shadow 0.3s ease;}
    .card:hover { transform: translateY(-5px); box-shadow:0 8px 25px var(--shadow); }
    .poster{width:100%; aspect-ratio:2/3; object-fit:cover; background:linear-gradient(135deg, #e2e8f0, #ced4da);}
    .card .meta{display:flex; gap:10px; padding:12px; align-items:flex-start; background: linear-gradient(180deg, transparent, rgba(0,0,0,0.05));}
    .fav{border:1px solid var(--chip-border); background:var(--chip-bg); border-radius:999px; padding:6px 10px; font-size:16px; cursor:pointer; color:var(--accent-color); transition: color 0.3s;}
    .fav:hover { color: var(--secondary-accent); }
    .muted{color:var(--muted); font-size:13px;}
    .toast{position:fixed; bottom:20px; inset-inline:0; display:flex; justify-content:center; z-index:100; pointer-events:none;}
    .toast>div{pointer-events:auto; border:1px solid var(--border); background:var(--card); padding:12px 16px; border-radius:12px; color:var(--text); box-shadow:0 4px 10px var(--shadow);}

    /* Addons block */
    .addons{border-top:1px solid var(--border); background:linear-gradient(180deg, rgba(78,205,196,0.1), transparent 90%); /* Colorful gradient */}
    .addons .wrap{display:grid; gap:16px; padding:20px 0;}
    .addon-grid{display:grid; gap:16px; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));}
    .addon{border:1px solid var(--border); background:var(--card); border-radius:16px; padding:16px; box-shadow:0 4px 15px var(--shadow); transition: transform 0.3s;}
    .addon:hover { transform: translateY(-3px); }
    .addon h3{margin:0 0 6px; font-size:18px; color: var(--brand-600);}
    .addon p{margin:0; color:var(--muted); font-size:14px;}
    .addon .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:rgba(0,0,0,0.1); padding:3px 7px; border-radius:6px; color: var(--secondary-accent);}

    /* Hide addons by default */
    .addons { display: none; }
</style>
</head>
<body>
<header class="topbar">
<div class="container">
<div class="row">
<h1>×”××œ×¦×•×ª ×œ×¡×¨×˜×™× ×•×¡×“×¨×•×ª</h1>
<button aria-label="××¦×‘ ×›×”×”/×‘×”×™×¨" class="btn ghost" id="themeBtn">â˜€ï¸ ××¦×‘ ×‘×”×™×¨</button>
</div>
</div>
</header>
<section class="filters">
<div class="container">
<div class="wrap">
<input aria-label="×—×™×¤×•×©" class="input" id="search" placeholder="×—×™×¤×•×© ×¡×¨×˜×™× ××• ×¡×“×¨×•×ªâ€¦"/>
<div>
<div class="chips" id="typeChips">
<button class="chip" data-type="movie">×¡×¨×˜×™×</button>
<button class="chip" data-type="tv">×¡×“×¨×•×ª</button>
<button class="chip" data-type="addons">×”×¨×—×‘×•×ª ×œ×”×ª×§× ×” ×¨×©××•× ×™×ª</button>
</div>
</div>
<div>
<select id="sort">
<option value="popularity.desc">××™×•×Ÿ: ×¤×•×¤×•×œ×¨×™×•×ª</option>
<option value="vote_average.desc">××™×•×Ÿ: ×“×™×¨×•×’</option>
<option value="primary_release_date.desc">××™×•×Ÿ: ×ª××¨×™×š ×™×¦×™××”</option>
</select>
</div>
</div>
</div>
</section>
<main class="container" id="mainContent">
<div class="muted" id="status" style="padding: 8px 0;">××•×›×Ÿ</div>
<div class="grid" id="grid"></div>
<div id="sentinel" style="height: 48px;"></div>
</main>
<!-- Addons Installer (× ×•×¡×£ ×‘×¢×“×™× ×•×ª, ×œ× ×”×•×¨×¡ ××ª ×”× ×¨××•×ª) -->
<section aria-labelledby="addonsTitle" class="addons" id="addonsSection">
<div class="container">
<div class="wrap">
<h2 id="addonsTitle" style="margin:0; font-size:18px;">×”×ª×§× ×ª ×”×¨×—×‘×•×ª (×œ×—×™×¦×” ××—×ª)</h2>
<p class="muted" style="margin:0">×œ×—×™×¦×” ×ª×¤×ª×— ××ª Stremio ×œ×”×ª×§× ×”. ×‘×× ×“×¨×•××™×“ × ×©×ª××© ×‘â€‘Intent ×‘××§×¨×” ×©×”×“×¤×“×¤×Ÿ ×—×•×¡×, ×•×‘â€‘iOS ××•×¦×’×ª ×”×¢×¨×” ×× ×”×”×ª×§× ×” ××•×’×‘×œ×ª.</p>
<div class="addon-grid">
<article class="addon">
<h3>Torrentio + Debrid</h3>
<p>××§×•×¨×•×ª ×¡×˜×¨×™× ××”×™×¨×™× ×œ×¡×¨×˜×™× ×•×¡×“×¨×•×ª (××•××œ×¥). <span class="kbd">movies &amp; series</span></p>
<div class="actions">
<button class="btn primary" data-addon="stremio://torrentio.strem.fun/easydebrid=n3cgfuzhg9ptzbss/manifest.json">×”×ª×§×Ÿ</button>
<button class="btn" data-copy="https://torrentio.strem.fun/easydebrid=n3cgfuzhg9ptzbss/manifest.json">×”×¢×ª×§ ×§×™×©×•×¨ (×œ××™×™×¤×•×Ÿ)</button>
</div>
</article>
<article class="addon">
<h3>Ktuvit (×›×ª×•×‘×™×•×ª)</h3>
<p>×›×ª×•×‘×™×•×ª ×‘×¢×‘×¨×™×ª ×â€‘Ktuvit. <span class="kbd">subtitles</span></p>
<div class="actions">
<button class="btn" data-addon="stremio://4b139a4b7f94-ktuvit-stremio.baby-beamup.club/manifest.json">×”×ª×§×Ÿ</button>
<button class="btn" data-copy="https://4b139a4b7f94-ktuvit-stremio.baby-beamup.club/manifest.json">×”×¢×ª×§ ×§×™×©×•×¨ (×œ××™×™×¤×•×Ÿ)</button>
</div>
</article>
<article class="addon">
<h3>Wizdom (×›×ª×•×‘×™×•×ª)</h3>
<p>×× ×•×¢ ×›×ª×•×‘×™×•×ª ××©×œ×™× ×‘×¢×‘×¨×™×ª. <span class="kbd">subtitles</span></p>
<div class="actions">
<button class="btn" data-addon="stremio://4b139a4b7f94-wizdom-stremio-v2.baby-beamup.club/manifest.json">×”×ª×§×Ÿ</button>
<button class="btn" data-copy="https://4b139a4b7f94-wizdom-stremio-v2.baby-beamup.club/manifest.json">×”×¢×ª×§ ×§×™×©×•×¨ (×œ××™×™×¤×•×Ÿ)</button>
</div>
</article>
<article class="addon">
<h3>×¡×¨×˜×™× ×©××’×™×¢×™× ×œ×¨×©×ª</h3>
<p>×§×˜×œ×•×’ ×”××¦×™×’ ××ª×™ ×¡×¨×˜×™× ××’×™×¢×™× ×œ×¨×©×ª ×‘××™×›×•×ª ×˜×•×‘×”. <span class="kbd">fresh releases</span></p>
<div class="actions">
<button class="btn" data-addon="stremio://stremio7rd-movies-online-dates.vercel.app/manifest.json">×”×ª×§×Ÿ</button>
<button class="btn" data-copy="https://stremio7rd-movies-online-dates.vercel.app/manifest.json">×”×¢×ª×§ ×§×™×©×•×¨ (×œ××™×™×¤×•×Ÿ)</button>
</div>
</article>
<article class="addon">
<h3>××™×“×¢ ×‘×¢×‘×¨×™×ª (TMDBâ€‘IL)</h3>
<p>×¤×•×¡×˜×¨×™×, ×ª×™××•×¨×™× ×•×—×™×¤×•×© ×ª×›× ×™× ×‘×¢×‘×¨×™×ª. <span class="kbd">Hebrew metadata</span></p>
<div class="actions">
<button class="btn" data-addon="stremio://94c8cb9f702d-tmdb-addon.baby-beamup.club/N4IgNghgdg5grhGBTEAuEALJBaAkgGRABoQBnAFwCckIBbAS1jQG0BdEgYwnIjAHsYpFqHoATNCHK1RAIwB05PgAdikgJ5KU6WnwBu9FCSh0tIAArK4kSqtIY+Ad1xQAEn1paqcJAF8iI8XQpWQVlVXINU1IkSgMhIxMJCyUrCBsSO0dnNw80L19-EDEJYPk1GnT1TQkdfUMQY1z0AE0K23snV3dPSm8-AJLpMraSCOr0aNikeIbElpGyDuzuvN6CgaChuUhYBGRwyJq9A1VG03xoeER6zM6cnr7C4s2Qnav90cOJmLjTuZALrtru0sl0mvl+kVApItlQkFBRIwYAdxiBaicEk0QAAVagIpEgu4rVAQp7Q0oKPGIpifVGTX6Y0y4+HU5EZJZgh6+dggLgUADCfDgUHIaAArD4gA/manifest.json">×”×ª×§×Ÿ</button>
<button class="btn" data-copy="https://94c8cb9f702d-tmdb-addon.baby-beamup.club/N4IgNghgdg5grhGBTEAuEALJBaAkgGRABoQBnAFwCckIBbAS1jQG0BdEgYwnIjAHsYpFqHoATNCHK1RAIwB05PgAdikgJ5KU6WnwBu9FCSh0tIAArK4kSqtIY+Ad1xQAEn1paqcJAF8iI8XQpWQVlVXINU1IkSgMhIxMJCyUrCBsSO0dnNw80L19-EDEJYPk1GnT1TQkdfUMQY1z0AE0K23snV3dPSm8-AJLpMraSCOr0aNikeIbElpGyDuzuvN6CgaChuUhYBGRwyJq9A1VG03xoeER6zM6cnr7C4s2Qnav90cOJmLjTuZALrtru0sl0mvl+kVApItlQkFBRIwYAdxiBaicEk0QAAVagIpEgu4rVAQp7Q0oKPGIpifVGTX6Y0y4+HU5EZJZgh6+dggLgUADCfDgUHIaAArD4gA/manifest.json">×”×¢×ª×§ ×§×™×©×•×¨ (×œ××™×™×¤×•×Ÿ)</button>
</div>
</article>
</div>
<div class="muted" style="font-size:12px">
<strong>×˜×™×¤:</strong> ×× ×œ×—×™×¦×” ×œ× ×¤×•×ª×—×ª ××ª ×”××¤×œ×™×§×¦×™×”, ×™×™×ª×›×Ÿ ×©×”×“×¤×“×¤×Ÿ ×—×•×¡× ×“×™×¤â€‘×œ×™× ×§×™×. ×‘×× ×“×¨×•××™×“ × × ×¡×” <span class="kbd">Android Intent</span> ×•× ×™×¤×•×œ ×œâ€‘Web ×× ×¦×¨×™×š. ×‘â€‘iOS (××™×™×¤×•×Ÿ), ×”×©×ª××© ×‘×›×¤×ª×•×¨ "×”×¢×ª×§ ×§×™×©×•×¨" ×›×“×™ ×œ×”×¢×ª×™×§ ××ª ×›×ª×•×‘×ª ×”â€‘HTTPS, ×•××– ×”×ª×§×Ÿ ×“×¨×š Stremio Web (web.stremio.com) ××• ×“×¡×§×˜×•×¤. Stremio Lite ×‘â€‘iOS ×¢×©×•×™ ×œ×”×™×•×ª ××•×’×‘×œ ×‘×”×ª×§× ×•×ª ××¡×•×™××•×ª.
</div>
</div>
</div>
</section>
<div class="toast" hidden="" id="toast">
<div id="toastMsg"></div>
</div>
<script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Telegram Web App API -->
<script>
  ;(() => {
    const API_KEY = '93f0d2ee2e3e60d061d14d91cbb47b46'
    const state = { theme: localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'), mediaType: localStorage.getItem('mediaType') || 'movie', sortBy: localStorage.getItem('sortBy') || 'popularity.desc', query: '', page: 1, totalPages: 1, favorites: new Set(JSON.parse(localStorage.getItem('favorites') || '[]')), loading: false, observer: null }
    const els = { themeBtn: document.getElementById('themeBtn'), search: document.getElementById('search'), typeChips: document.getElementById('typeChips'), sort: document.getElementById('sort'), grid: document.getElementById('grid'), sentinel: document.getElementById('sentinel'), status: document.getElementById('status'), toast: document.getElementById('toast'), toastMsg: document.getElementById('toastMsg'), mainContent: document.getElementById('mainContent'), addonsSection: document.getElementById('addonsSection') }

    // Telegram Web App Integration
    const isTelegram = window.Telegram && Telegram.WebApp;
    if (isTelegram) {
      Telegram.WebApp.ready(); // Signal that the app is ready
      Telegram.WebApp.expand(); // Expand to full screen
      const tgTheme = Telegram.WebApp.themeParams.bg_color ? (Telegram.WebApp.colorScheme === 'dark' ? 'dark' : 'light') : state.theme;
      state.theme = tgTheme;
      applyTheme(); // Apply Telegram's theme
      
      // Main Button (bottom button in Telegram)
      Telegram.WebApp.MainButton.setText('×—×–×•×¨ ×œ×”×ª×—×œ×”').show().onClick(() => {
        els.search.value = ''; state.query = ''; restartFeed(); // Example action: reset search
      });
      
      // Hide theme button if in Telegram (use Telegram's theme)
      els.themeBtn.style.display = 'none';
    }

    function applyTheme(){ document.documentElement.classList.toggle('dark', state.theme === 'dark'); els.themeBtn.textContent = state.theme === 'dark' ? 'ğŸŒ™ ××¦×‘ ×›×”×”' : 'â˜€ï¸ ××¦×‘ ×‘×”×™×¨' }
    function toggleTheme(){ state.theme = state.theme === 'dark' ? 'light' : 'dark'; localStorage.setItem('theme', state.theme); applyTheme() }

    const TMDB = 'https://api.themoviedb.org/3'; const IMG = 'https://image.tmdb.org/t/p/'
    async function tmdb(path, params={}){ const url = new URL(TMDB + path); const sp = new URLSearchParams({ api_key: API_KEY, language: 'he-IL', include_adult: 'false', ...params }); url.search = sp.toString(); const res = await fetch(url.toString()); if(!res.ok){ const text = await res.text().catch(()=>res.statusText); throw new Error('TMDB ' + res.status + ': ' + text) } return res.json() }

    // Platform detection
    function getPlatform(){ const ua = navigator.userAgent || navigator.vendor || ''; return { ios: /iPad|iPhone|iPod/i.test(ua), android: /Android/i.test(ua) } }

    // IMDb cache + deep-link builders
    const imdbCache = new Map()
    async function getImdbId(item){ if(imdbCache.has(item.id)) return imdbCache.get(item.id); const type = (item.media_type || state.mediaType); try{ const data = await tmdb(`/${type==='tv'?'tv':'movie'}/${item.id}/external_ids`); const imdb = data && data.imdb_id ? data.imdb_id : null; imdbCache.set(item.id, imdb); return imdb } catch { return null } }
    function stremioDetailURL(type, imdb){ const t = (type==='tv'?'series':'movie'); return t==='movie' ? `stremio:///detail/${t}/${imdb}/${imdb}` : `stremio:///detail/${t}/${imdb}` }
    function stremioWebURL(type, imdb){ const t = (type==='tv'?'series':'movie'); return `https://web.stremio.com/#/detail/${t}/${imdb}` }

    function androidIntentFromDeeplink(deeplink, storeFallback){ const pp = deeplink.replace('stremio:///','').replace('stremio://',''); return `intent://${pp}#Intent;scheme=stremio;package=com.stremio.one;S.browser_fallback_url=${encodeURIComponent(storeFallback)};end` }

    function openWithFallback(deeplink, webUrl){ 
      const { ios, android } = getPlatform(); 
      const httpsLink = deeplink.replace('stremio://', 'https://'); // HTTPS fallback for addons
      let hidden = false; 
      const onHide = () => { hidden = true; cleanup() }; 
      document.addEventListener('visibilitychange', onHide, { once:true }); 
      const cleanup = () => { clearTimeout(timer); document.removeEventListener('visibilitychange', onHide) }; 
      try { 
        if (isTelegram) {
          // Special handling for Telegram: Open HTTPS link externally
          Telegram.WebApp.openLink(httpsLink);
          return;
        } else if(android){ 
          const play = 'https://play.google.com/store/apps/details?id=com.stremio.one'; 
          window.location.href = androidIntentFromDeeplink(deeplink, play) 
        } else { 
          window.location.href = deeplink 
        } 
      } catch{} 
      const timer = setTimeout(() => { 
        if(hidden) return; 
        if(webUrl) window.open(webUrl, '_blank','noopener') 
        else window.open(httpsLink, '_blank','noopener'); // Fallback to HTTPS for addons
      }, 900) 
    }

    // Toast function (added for iOS alerts and copies)
    function showToast(msg) { els.toastMsg.textContent = msg; els.toast.hidden = false; setTimeout(() => els.toast.hidden = true, 3000); }

    // Addons buttons
    document.querySelectorAll('[data-addon]').forEach(btn => { btn.addEventListener('click', e => { e.preventDefault(); const link = btn.getAttribute('data-addon'); const { ios } = getPlatform(); if(ios){ const httpsLink = link.replace('stremio://', 'https://'); navigator.clipboard.writeText(httpsLink).then(() => showToast('×”×§×™×©×•×¨ HTTPS ×”×•×¢×ª×§ ×œ×œ×•×—! ×¤×ª×— Stremio Web/×“×¡×§×˜×•×¤ ×•×”×“×‘×§ ×œ×”×ª×§× ×”.')).catch(() => showToast('×œ× × ×™×ª×Ÿ ×œ×”×¢×ª×™×§ ××•×˜×•××˜×™×ª. × × ×œ×”×¢×ª×™×§ ×™×“× ×™×ª ××”×›×¤×ª×•×¨ ×œ××˜×”.')); return } openWithFallback(link); }) })
    document.querySelectorAll('[data-copy]').forEach(btn => { btn.addEventListener('click', async () => { const url = btn.getAttribute('data-copy'); try{ await navigator.clipboard.writeText(url); showToast('×”×§×™×©×•×¨ ×”×•×¢×ª×§ ×œ×œ×•×—') }catch{ showToast('×œ× × ×™×ª×Ÿ ×œ×”×¢×ª×™×§ â€” × × ×œ×”×¢×ª×™×§ ×™×“× ×™×ª') } }) })

    // Recommendations: single "Open in Stremio" button
    function card(item){ const title = item.title || item.name || 'â€”'; const date = item.release_date || item.first_air_date || ''; const vote = (item.vote_average && item.vote_average.toFixed) ? item.vote_average.toFixed(1) : 'â€”'; const id = item.id; const fav = state.favorites.has(id); const href = `https://www.themoviedb.org/${state.mediaType}/${id}`; const div = document.createElement('div'); div.className='card'; div.innerHTML = `${item.poster_path ? `<img class="poster" loading="lazy" alt="${title}" src="${IMG}w342${item.poster_path}">` : `<div class="poster"></div>`}<div class="meta"><button aria-label="××•×¢×“×¤×™×" class="fav" data-id="${id}">${fav ? 'â˜…' : 'â˜†'}</button><div style="min-width:0;"><div style="font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="${title}">${title}</div><div class="muted">${date} Â· â­ ${vote}</div><div style="margin-top:6px;"><button class="btn sm primary" data-action="stremio">×¤×ª×— ×‘â€‘Stremio â¤´</button> <a href="${href}" target="_blank" rel="noopener" class="btn sm">TMDB â†—</a></div></div></div>`; const favBtn=div.querySelector('.fav'); favBtn.addEventListener('click', ()=>{ const id = Number(favBtn.getAttribute('data-id')); if(state.favorites.has(id)) state.favorites.delete(id); else state.favorites.add(id); localStorage.setItem('favorites', JSON.stringify([...state.favorites])); favBtn.textContent = state.favorites.has(id) ? 'â˜…' : 'â˜†' }); const appBtn = div.querySelector('[data-action="stremio"]'); appBtn.addEventListener('click', async (ev)=>{ ev.preventDefault(); const imdb = await getImdbId(item); if(!imdb){ const q = encodeURIComponent(item.title||item.name||''); openWithFallback(`stremio:///search?query=${q}`, `https://web.stremio.com/#/search?query=${q}`); return } const type = (item.media_type || state.mediaType); openWithFallback(stremioDetailURL(type, imdb), stremioWebURL(type, imdb)) }); return div }

    async function fetchPage(page){ const isSearch = !!state.query; const path = isSearch ? `/search/${state.mediaType}` : `/discover/${state.mediaType}`; const params = isSearch ? { query: state.query, page } : { sort_by: state.sortBy, page, 'vote_count.gte': '50' }; return tmdb(path, params) }
    async function loadMore(){ if(state.loading) return; if(state.page > state.totalPages) return; state.loading = true; els.status.textContent = `×˜×•×¢×Ÿ ×¢××•×“ ${state.page}â€¦`; try{ const data = await fetchPage(state.page); state.totalPages = data.total_pages || 1; (data.results || []).forEach(it => els.grid.appendChild(card(it))); state.page += 1; els.status.textContent = state.page > state.totalPages ? '×”×’×¢×ª ×œ×¡×•×£ ğŸ¬' : '××•×›×Ÿ' }catch(err){ console.error(err); els.status.textContent = '×©×’×™××”' } finally{ state.loading = false } }
    function restartFeed(){ state.page = 1; state.totalPages = 1; els.grid.innerHTML = ''; loadMore() }

    // Function to switch tabs (movies/tv/addons)
    function switchTab(type) {
      state.mediaType = type;
      localStorage.setItem('mediaType', type);
      document.querySelectorAll('#typeChips .chip').forEach(x => x.classList.toggle('active', x.getAttribute('data-type') === type));
      
      if (type === 'addons') {
        els.mainContent.style.display = 'none';
        els.addonsSection.style.display = 'block';
        if (state.observer) state.observer.disconnect(); // Stop infinite scroll
      } else {
        els.mainContent.style.display = 'block';
        els.addonsSection.style.display = 'none';
        restartFeed();
        if (state.observer) state.observer.observe(els.sentinel); // Restart infinite scroll
      }
    }

    // INIT
    applyTheme(); 
    els.themeBtn.addEventListener('click', toggleTheme); 
    els.typeChips.querySelectorAll('.chip').forEach(btn => { 
      const t = btn.getAttribute('data-type'); 
      btn.classList.toggle('active', t === state.mediaType); 
      btn.onclick = () => { 
        if (state.mediaType === t) return; 
        switchTab(t); 
      } 
    });
    els.sort.value = state.sortBy; 
    els.sort.addEventListener('change', () => { 
      state.sortBy = els.sort.value; 
      localStorage.setItem('sortBy', state.sortBy); 
      if (state.mediaType !== 'addons') restartFeed(); 
    });
    let searchTimer; 
    els.search.addEventListener('input', (e)=>{ 
      clearTimeout(searchTimer); 
      searchTimer = setTimeout(()=>{ 
        state.query = e.target.value.trim(); 
        if (state.mediaType !== 'addons') { 
          document.getElementById('grid').scrollIntoView({behavior:'smooth', block:'start'}); 
          restartFeed(); 
        } 
      }, 350) 
    });
    switchTab(state.mediaType); // Initialize the correct tab

    // Infinite scroll observer (only for movies/tv)
    state.observer = new IntersectionObserver(entries => { if (entries[0].isIntersecting && state.mediaType !== 'addons') loadMore(); }, { threshold: 0.1 });
    if (state.mediaType !== 'addons') state.observer.observe(els.sentinel);
  })()
  </script>
</body>
</html>


